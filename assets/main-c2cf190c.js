import{j as lt,c as U,e as X,a as me,b as ct,d as ut}from"./Checkpoints-3688cd3c.js";class R{constructor(t){this.properties=t??[]}get(t){const o=this.properties.filter(n=>n.name===t).map(n=>n.value);if(o.length>1)throw new Error('Expected only one property to be named "'+t+'"');if(o.length!==0)return o[0]}getString(t){return this.getByType(t,"string")}getNumber(t){return this.getByType(t,"number")}getBoolean(t){return this.getByType(t,"boolean")}getByType(t,o){const n=this.get(t);if(n!==void 0){if(o!=="json"&&typeof n!==o)throw new Error('Expected property "'+t+'" to have type "'+o+'"');return n}}mustGetString(t){return this.mustGetByType(t,"string")}mustGetNumber(t){return this.mustGetByType(t,"number")}mustGetBoolean(t){return this.mustGetByType(t,"boolean")}mustGetByType(t,o){const n=this.get(t);if(n===void 0)throw new Error('Property "'+t+'" is missing');if(o!=="json"&&typeof n!==o)throw new Error('Expected property "'+t+'" to have type "'+o+'"');return n}getType(t){const o=this.properties.filter(n=>n.name===t).map(n=>n.type);if(o.length>1)throw new Error('Expected only one property to be named "'+t+'"');if(o.length!==0)return o[0]}}const $e="https://unpkg.com/@workadventure/scripting-api-extra@1.7.7/dist";class ft{constructor(t){this.name=t.name,this.x=t.x,this.y=t.y,this.properties=new R(t.properties)}get isReadable(){const t=this.properties.getString("readableBy");return t?WA.player.tags.includes(t):!0}get isWritable(){const t=this.properties.getString("writableBy");return t?WA.player.tags.includes(t):!0}}function be(e){const t=e?"#"+e.join():"";WA.nav.openCoWebSite($e+"/configuration.html"+t,!0)}async function dt(e,t){const o=await WA.room.getTiledMap(),n=new Map;return Me(o.layers,n,e,t),n}function Me(e,t,o,n){for(const r of e)if(r.type==="objectgroup"){for(const s of r.objects)if(s.type==="variable"||s.class==="variable"){if(o&&r.name!==o||n&&!n.includes(s.name))continue;t.set(s.name,new ft(s))}}else r.type==="group"&&Me(r.layers,t,o,n)}let te;async function J(){return te===void 0&&(te=pt()),te}async function pt(){return gt(await WA.room.getTiledMap())}function gt(e){const t=new Map;return Re(e.layers,"",t),t}function Re(e,t,o){for(const n of e)n.type==="group"?Re(n.layers,t+n.name+"/",o):(n.name=t+n.name,o.set(n.name,n))}async function Fe(){const e=await J(),t=[];for(const o of e.values())if(o.type==="objectgroup")for(const n of o.objects)(n.type==="area"||n.class==="area")&&t.push(n);return t}function yt(e){let t=1/0,o=1/0,n=0,r=0;const s=e.data;if(typeof s=="string")throw new Error("Unsupported tile layer data stored as string instead of CSV");for(let i=0;i<e.height;i++)for(let a=0;a<e.width;a++)s[a+i*e.width]!==0&&(t=Math.min(t,a),r=Math.max(r,a),o=Math.min(o,i),n=Math.max(n,i));return{top:o,left:t,right:r+1,bottom:n+1}}function Ie(e){let t=1/0,o=1/0,n=0,r=0;for(const s of e){const i=yt(s);i.left<t&&(t=i.left),i.top<o&&(o=i.top),i.right>r&&(r=i.right),i.bottom>n&&(n=i.bottom)}return{top:o,left:t,right:r,bottom:n}}/*!
 * mustache.js - Logic-less {{mustache}} templates with JavaScript
 * http://github.com/janl/mustache.js
 */var ht=Object.prototype.toString,I=Array.isArray||function(t){return ht.call(t)==="[object Array]"};function le(e){return typeof e=="function"}function mt(e){return I(e)?"array":typeof e}function oe(e){return e.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}function Ae(e,t){return e!=null&&typeof e=="object"&&t in e}function bt(e,t){return e!=null&&typeof e!="object"&&e.hasOwnProperty&&e.hasOwnProperty(t)}var At=RegExp.prototype.test;function wt(e,t){return At.call(e,t)}var vt=/\S/;function Wt(e){return!wt(vt,e)}var Tt={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;","`":"&#x60;","=":"&#x3D;"};function Ct(e){return String(e).replace(/[&<>"'`=\/]/g,function(o){return Tt[o]})}var xt=/\s*/,kt=/\s+/,we=/\s*=/,St=/\s*\}/,Et=/#|\^|\/|>|\{|&|=|!/;function Pt(e,t){if(!e)return[];var o=!1,n=[],r=[],s=[],i=!1,a=!1,l="",c=0;function f(){if(i&&!a)for(;s.length;)delete r[s.pop()];else s=[];i=!1,a=!1}var p,v,_;function O(k){if(typeof k=="string"&&(k=k.split(kt,2)),!I(k)||k.length!==2)throw new Error("Invalid tags: "+k);p=new RegExp(oe(k[0])+"\\s*"),v=new RegExp("\\s*"+oe(k[1])),_=new RegExp("\\s*"+oe("}"+k[1]))}O(t||h.tags);for(var d=new H(e),W,u,A,V,Y,L;!d.eos();){if(W=d.pos,A=d.scanUntil(p),A)for(var ee=0,at=A.length;ee<at;++ee)V=A.charAt(ee),Wt(V)?(s.push(r.length),l+=V):(a=!0,o=!0,l+=" "),r.push(["text",V,W,W+1]),W+=1,V===`
`&&(f(),l="",c=0,o=!1);if(!d.scan(p))break;if(i=!0,u=d.scan(Et)||"name",d.scan(xt),u==="="?(A=d.scanUntil(we),d.scan(we),d.scanUntil(v)):u==="{"?(A=d.scanUntil(_),d.scan(St),d.scanUntil(v),u="&"):A=d.scanUntil(v),!d.scan(v))throw new Error("Unclosed tag at "+d.pos);if(u==">"?Y=[u,A,W,d.pos,l,c,o]:Y=[u,A,W,d.pos],c++,r.push(Y),u==="#"||u==="^")n.push(Y);else if(u==="/"){if(L=n.pop(),!L)throw new Error('Unopened section "'+A+'" at '+W);if(L[1]!==A)throw new Error('Unclosed section "'+L[1]+'" at '+W)}else u==="name"||u==="{"||u==="&"?a=!0:u==="="&&O(A)}if(f(),L=n.pop(),L)throw new Error('Unclosed section "'+L[1]+'" at '+d.pos);return Lt(Bt(r))}function Bt(e){for(var t=[],o,n,r=0,s=e.length;r<s;++r)o=e[r],o&&(o[0]==="text"&&n&&n[0]==="text"?(n[1]+=o[1],n[3]=o[3]):(t.push(o),n=o));return t}function Lt(e){for(var t=[],o=t,n=[],r,s,i=0,a=e.length;i<a;++i)switch(r=e[i],r[0]){case"#":case"^":o.push(r),n.push(r),o=r[4]=[];break;case"/":s=n.pop(),s[5]=r[2],o=n.length>0?n[n.length-1][4]:t;break;default:o.push(r)}return t}function H(e){this.string=e,this.tail=e,this.pos=0}H.prototype.eos=function(){return this.tail===""};H.prototype.scan=function(t){var o=this.tail.match(t);if(!o||o.index!==0)return"";var n=o[0];return this.tail=this.tail.substring(n.length),this.pos+=n.length,n};H.prototype.scanUntil=function(t){var o=this.tail.search(t),n;switch(o){case-1:n=this.tail,this.tail="";break;case 0:n="";break;default:n=this.tail.substring(0,o),this.tail=this.tail.substring(o)}return this.pos+=n.length,n};function F(e,t){this.view=e,this.cache={".":this.view},this.parent=t}F.prototype.push=function(t){return new F(t,this)};F.prototype.lookup=function(t){var o=this.cache,n;if(o.hasOwnProperty(t))n=o[t];else{for(var r=this,s,i,a,l=!1;r;){if(t.indexOf(".")>0)for(s=r.view,i=t.split("."),a=0;s!=null&&a<i.length;)a===i.length-1&&(l=Ae(s,i[a])||bt(s,i[a])),s=s[i[a++]];else s=r.view[t],l=Ae(r.view,t);if(l){n=s;break}r=r.parent}o[t]=n}return le(n)&&(n=n.call(this.view)),n};function y(){this.templateCache={_cache:{},set:function(t,o){this._cache[t]=o},get:function(t){return this._cache[t]},clear:function(){this._cache={}}}}y.prototype.clearCache=function(){typeof this.templateCache<"u"&&this.templateCache.clear()};y.prototype.parse=function(t,o){var n=this.templateCache,r=t+":"+(o||h.tags).join(":"),s=typeof n<"u",i=s?n.get(r):void 0;return i==null&&(i=Pt(t,o),s&&n.set(r,i)),i};y.prototype.render=function(t,o,n,r){var s=this.getConfigTags(r),i=this.parse(t,s),a=o instanceof F?o:new F(o,void 0);return this.renderTokens(i,a,n,t,r)};y.prototype.renderTokens=function(t,o,n,r,s){for(var i="",a,l,c,f=0,p=t.length;f<p;++f)c=void 0,a=t[f],l=a[0],l==="#"?c=this.renderSection(a,o,n,r,s):l==="^"?c=this.renderInverted(a,o,n,r,s):l===">"?c=this.renderPartial(a,o,n,s):l==="&"?c=this.unescapedValue(a,o):l==="name"?c=this.escapedValue(a,o,s):l==="text"&&(c=this.rawValue(a)),c!==void 0&&(i+=c);return i};y.prototype.renderSection=function(t,o,n,r,s){var i=this,a="",l=o.lookup(t[1]);function c(v){return i.render(v,o,n,s)}if(l){if(I(l))for(var f=0,p=l.length;f<p;++f)a+=this.renderTokens(t[4],o.push(l[f]),n,r,s);else if(typeof l=="object"||typeof l=="string"||typeof l=="number")a+=this.renderTokens(t[4],o.push(l),n,r,s);else if(le(l)){if(typeof r!="string")throw new Error("Cannot use higher-order sections without the original template");l=l.call(o.view,r.slice(t[3],t[5]),c),l!=null&&(a+=l)}else a+=this.renderTokens(t[4],o,n,r,s);return a}};y.prototype.renderInverted=function(t,o,n,r,s){var i=o.lookup(t[1]);if(!i||I(i)&&i.length===0)return this.renderTokens(t[4],o,n,r,s)};y.prototype.indentPartial=function(t,o,n){for(var r=o.replace(/[^ \t]/g,""),s=t.split(`
`),i=0;i<s.length;i++)s[i].length&&(i>0||!n)&&(s[i]=r+s[i]);return s.join(`
`)};y.prototype.renderPartial=function(t,o,n,r){if(n){var s=this.getConfigTags(r),i=le(n)?n(t[1]):n[t[1]];if(i!=null){var a=t[6],l=t[5],c=t[4],f=i;l==0&&c&&(f=this.indentPartial(i,c,a));var p=this.parse(f,s);return this.renderTokens(p,o,n,f,r)}}};y.prototype.unescapedValue=function(t,o){var n=o.lookup(t[1]);if(n!=null)return n};y.prototype.escapedValue=function(t,o,n){var r=this.getConfigEscape(n)||h.escape,s=o.lookup(t[1]);if(s!=null)return typeof s=="number"&&r===h.escape?String(s):r(s)};y.prototype.rawValue=function(t){return t[1]};y.prototype.getConfigTags=function(t){return I(t)?t:t&&typeof t=="object"?t.tags:void 0};y.prototype.getConfigEscape=function(t){if(t&&typeof t=="object"&&!I(t))return t.escape};var h={name:"mustache.js",version:"4.2.0",tags:["{{","}}"],clearCache:void 0,escape:void 0,parse:void 0,render:void 0,Scanner:void 0,Context:void 0,Writer:void 0,set templateCache(e){j.templateCache=e},get templateCache(){return j.templateCache}},j=new y;h.clearCache=function(){return j.clearCache()};h.parse=function(t,o){return j.parse(t,o)};h.render=function(t,o,n,r){if(typeof t!="string")throw new TypeError('Invalid template! Template should be a "string" but "'+mt(t)+'" was given as the first argument for mustache#render(template, view, partials)');return j.render(t,o,n,r)};h.escape=Ct;h.Scanner=H;h.Context=F;h.Writer=y;class Oe{constructor(t,o){this.template=t,this.state=o,this.ast=h.parse(t)}getValue(){return this.value===void 0&&(this.value=h.render(this.template,this.state)),this.value}onChange(t){const o=[];for(const n of this.getUsedVariables().values())o.push(this.state.onVariableChange(n).subscribe(()=>{const r=h.render(this.template,this.state);r!==this.value&&(this.value=r,t(this.value))}));return{unsubscribe:()=>{for(const n of o)n.unsubscribe()}}}isPureString(){return this.ast.length===0||this.ast.length===1&&this.ast[0][0]==="text"}getUsedVariables(){const t=new Set;return this.recursiveGetUsedVariables(this.ast,t),t}recursiveGetUsedVariables(t,o){for(const n of t){const r=n[0],s=n[1],i=n[4];["name","&","#","^"].includes(r)&&o.add(s),i!==void 0&&typeof i!="string"&&this.recursiveGetUsedVariables(i,o)}}}async function Dt(){var e;const t=await Fe();for(const o of t){const n=(e=o.properties)!==null&&e!==void 0?e:[];for(const r of n){if(r.type==="int"||r.type==="bool"||r.type==="object"||typeof r.value!="string")continue;const s=new Oe(r.value,WA.state);if(s.isPureString())continue;const i=s.getValue();await ve(o.name,r.name,i),s.onChange(async a=>{await ve(o.name,r.name,a)})}}}async function Nt(){var e;const t=await J();for(const[o,n]of t.entries())if(n.type!=="objectgroup"){const r=(e=n.properties)!==null&&e!==void 0?e:[];for(const s of r){if(s.type==="int"||s.type==="bool"||s.type==="object"||typeof s.value!="string")continue;const i=new Oe(s.value,WA.state);if(i.isPureString())continue;const a=i.getValue();We(o,s.name,a),i.onChange(l=>{We(o,s.name,l)})}}}async function ve(e,t,o){console.log(e),(await WA.room.area.get(e)).setProperty(t,o)}function We(e,t,o){WA.room.setProperty(e,t,o),t==="visible"&&(o?WA.room.showLayer(e):WA.room.hideLayer(e))}const $t="https://admin.workadventu.re/html";let re,ce=0,ue=0;function Te(e){if(WA.state[e.name]){let t=e.properties.mustGetString("openLayer");for(const o of t.split(`
`))WA.room.showLayer(o);t=e.properties.mustGetString("closeLayer");for(const o of t.split(`
`))WA.room.hideLayer(o)}else{let t=e.properties.mustGetString("openLayer");for(const o of t.split(`
`))WA.room.hideLayer(o);t=e.properties.mustGetString("closeLayer");for(const o of t.split(`
`))WA.room.showLayer(o)}}function Mt(e){const t=e.properties.getString("openSound"),o=e.properties.getNumber("soundRadius");let n=1;if(o){const r=Ge(e.properties.mustGetString("openLayer").split(`
`));if(r>o)return;n=1-r/o}t&&WA.sound.loadSound(t).play({volume:n})}function Rt(e){const t=e.properties.getString("closeSound"),o=e.properties.getNumber("soundRadius");let n=1;if(o){const r=Ge(e.properties.mustGetString("closeLayer").split(`
`));if(r>o)return;n=1-r/o}t&&WA.sound.loadSound(t).play({volume:n})}function Ve(e){return e.map(t=>re.get(t)).filter(t=>(t==null?void 0:t.type)==="tilelayer")}function Ge(e){const t=Ve(e),o=Ie(t),n=((o.right-o.left)/2+o.left)*32,r=((o.bottom-o.top)/2+o.top)*32;return Math.sqrt(Math.pow(ce-n,2)+Math.pow(ue-r,2))}function Ft(e){WA.state.onVariableChange(e.name).subscribe(()=>{WA.state[e.name]?Mt(e):Rt(e),Te(e)}),Te(e)}function Ce(e,t,o,n){const r=e.name;let s,i,a=!1;const l=o.getString("tag");let c=!0;l&&!WA.player.tags.includes(l)&&(c=!1);const f=!!l;function p(){var u;s&&s.remove(),s=WA.ui.displayActionMessage({message:(u=o.getString("closeTriggerMessage"))!==null&&u!==void 0?u:"Press SPACE to close the door",callback:()=>{WA.state[t.name]=!1,v()}})}function v(){var u;s&&s.remove(),s=WA.ui.displayActionMessage({message:(u=o.getString("openTriggerMessage"))!==null&&u!==void 0?u:"Press SPACE to open the door",callback:()=>{WA.state[t.name]=!0,p()}})}function _(){let u;if(e.type==="tilelayer")u=Ie(Ve(t.properties.mustGetString("closeLayer").split(`
`)));else{if(e.x===void 0||e.y===void 0||e.width===void 0||e.height===void 0)throw new Error(`Doorstep zone "${e.name}" is missing x, y, width or height`);u={top:e.y,left:e.x,right:e.x+e.width,bottom:e.y+e.height}}i=WA.room.website.create({name:"doorKeypad"+r,url:n+"/keypad.html#"+encodeURIComponent(r),position:{x:u.right*32,y:u.top*32,width:32*3,height:32*4},allowApi:!0})}function O(){i&&(WA.room.website.delete(i.name),i=void 0)}function d(){if(a=!0,o.getBoolean("autoOpen")&&c){WA.state[t.name]=!0;return}if(!WA.state[t.name]&&(f&&!c||!f)&&(o.getString("code")||o.getString("codeVariable"))){_();return}c&&(WA.state[t.name]?p():v())}function W(){a=!1,o.getBoolean("autoClose")&&(WA.state[t.name]=!1),s&&s.remove(),O()}e.type==="tilelayer"?(WA.room.onEnterLayer(r).subscribe(d),WA.room.onLeaveLayer(r).subscribe(W)):(WA.room.area.onEnter(r).subscribe(d),WA.room.area.onLeave(r).subscribe(W)),WA.state.onVariableChange(t.name).subscribe(()=>{a&&(!o.getBoolean("autoClose")&&WA.state[t.name]===!0&&p(),i&&WA.state[t.name]===!0&&O(),!o.getBoolean("autoOpen")&&WA.state[t.name]===!1&&v())})}function It(e){const t=e.properties.mustGetString("bellSound"),o=e.properties.getNumber("soundRadius");let n=1;if(o){const r=Math.sqrt(Math.pow(e.x-ce,2)+Math.pow(e.y-ue,2));if(r>o)return;n=1-r/o}WA.sound.loadSound(t).play({volume:n})}function Ot(e){WA.state[e.name]===void 0&&(WA.state[e.name]=0),WA.state.onVariableChange(e.name).subscribe(()=>{WA.state[e.name]&&It(e)})}function xe(e,t,o){let n;const r=t.getString("bellPopup");if(o.type==="tilelayer"){const s=o.name;WA.room.onEnterLayer(s).subscribe(()=>{var i;r?n=WA.ui.openPopup(r,"",[{label:(i=t.getString("bellButtonText"))!==null&&i!==void 0?i:"Ring",callback:()=>{WA.state[e]=WA.state[e]+1}}]):WA.state[e]=WA.state[e]+1}),WA.room.onLeaveLayer(s).subscribe(()=>{n&&(n.close(),n=void 0)})}else{const s=o.name;WA.room.area.onEnter(s).subscribe(()=>{var i;r?n=WA.ui.openPopup(r,"",[{label:(i=t.getString("bellButtonText"))!==null&&i!==void 0?i:"Ring",callback:()=>{WA.state[e]=WA.state[e]+1}}]):WA.state[e]=WA.state[e]+1}),WA.room.area.onLeave(s).subscribe(()=>{n&&(n.close(),n=void 0)})}}async function Vt(e){e=e??$t;const t=await dt();re=await J();for(const o of t.values())o.properties.get("door")&&Ft(o),o.properties.get("bell")&&Ot(o);for(const o of re.values()){const n=new R(o.properties),r=n.getString("doorVariable");if(r&&o.type==="tilelayer"){const i=t.get(r);if(i===void 0)throw new Error('Cannot find variable "'+r+'" referred in the "doorVariable" property of layer "'+o.name+'"');Ce(o,i,n,e)}const s=n.getString("bellVariable");s&&o.type==="tilelayer"&&xe(s,n,o)}for(const o of await Fe()){const n=new R(o.properties),r=n.getString("doorVariable");if(r){const i=t.get(r);if(i===void 0)throw new Error('Cannot find variable "'+r+'" referred in the "doorVariable" property of object "'+o.name+'"');Ce(o,i,n,e)}const s=n.getString("bellVariable");s&&xe(s,n,o)}WA.player.onPlayerMove(o=>{ce=o.x,ue=o.y})}function Gt(e,t){const o=e.getString("bindVariable");if(o){const n=e.get("enterValue"),r=e.get("leaveValue"),s=e.getString("triggerMessage"),i=e.getString("tag");jt(o,t,n,r,s,i)}}function jt(e,t,o,n,r,s){s&&!WA.player.tags.includes(s)||(o!==void 0&&WA.room.onEnterLayer(t).subscribe(()=>{r||(WA.state[e]=o)}),n!==void 0&&WA.room.onLeaveLayer(t).subscribe(()=>{WA.state[e]=n}))}async function Ut(){const e=await J();for(const t of e.values()){const o=new R(t.properties);Gt(o,t.name)}}let ke;async function Jt(e){const t=await WA.room.getTiledMap();e=e??$e,ke=await J();const o=t.layers.find(n=>n.name==="configuration");if(o){const r=new R(o.properties).getString("tag");(!r||WA.player.tags.includes(r))&&WA.ui.registerMenuCommand("Configure the room",()=>{WA.nav.openCoWebSite(e+"/configuration.html",!0)});for(const s of ke.values()){const i=new R(s.properties),a=i.getString("openConfig");a&&s.type==="tilelayer"&&Ht(a.split(","),s.name,i)}}}function Ht(e,t,o){let n;const r=o.getString("openConfigAdminTag");let s=!0;r&&!WA.player.tags.includes(r)&&(s=!1);function i(){var l;n&&n.remove(),n=WA.ui.displayActionMessage({message:(l=o.getString("openConfigTriggerMessage"))!==null&&l!==void 0?l:"Press SPACE or touch here to configure",callback:()=>be(e)})}function a(){WA.nav.closeCoWebSite()}WA.room.onEnterLayer(t).subscribe(()=>{const l=o.getString("openConfigTrigger");s&&(l&&l==="onaction"?i():be(e))}),WA.room.onLeaveLayer(t).subscribe(()=>{n&&n.remove(),a()})}function _t(){return WA.onInit().then(()=>{Vt().catch(e=>console.error(e)),Ut().catch(e=>console.error(e)),Jt().catch(e=>console.error(e)),Nt().catch(e=>console.error(e)),Dt().catch(e=>console.error(e))}).catch(e=>console.error(e))}async function je(){let e=[];const t=await WA.player.state.checklist;return t?e=t:fe(e),e}function fe(e){WA.player.state.saveVariable("checklist",e,{public:!1,persist:!0,ttl:48*3600,scope:"world"})}async function S(){let e=[];const t=await WA.player.state.checkpointIds;return t?e=t:C(e),e}function C(e){WA.player.state.saveVariable("checkpointIds",e,{public:!1,persist:!0,ttl:48*3600,scope:"world"})}function Ue(e){const t=e.find(o=>!o.done);return t?t.id:"-1"}function Yt(e){const t=e.map(Number),o=lt.map(Number),n=Math.max(...t),r=o.find(s=>s>n);return r!==void 0?r.toString():"-1"}function Je(e,t){return e.includes(t)}function zt(e){return e.includes("2")}function qt(e){return parseInt(e,10)>2}function He(e){return e.includes("4")}function Kt(e){return e.includes("6")}function de(e){return e==="7"}function _e(e){return e.includes("7")}function Xt(e){return e.includes("9")}function Qt(e){return e.includes("10")}function Zt(e){return e.includes("11")}function eo(e){return e.includes("12")}function to(e){return e.includes("13")}function Ye(e){return["14","15"].every(t=>e.includes(t))}function ze(e){return["16","17"].every(t=>e.includes(t))}function qe(e){return["18","19"].every(t=>e.includes(t))}function Ke(e){return["20","21"].every(t=>e.includes(t))}function oo(e){return e.includes("22")}function no(e){return e.includes("24")}function Q(e){const t=parseInt(e,10);return 25<=t&&t<=29}function ro(e){return e.includes("25")}function so(e){return e.includes("26")}function io(e){return e.includes("27")}function ao(e){return e.includes("28")}function lo(e){return e.includes("29")}function co(e){return e.includes("32")}function uo(e){return["33","34"].every(t=>e.includes(t))}function Xe(e){return e.includes("34")}function fo(e){return parseInt(e,10)>34}function pe(){return WA.player.tags}const $=["ext","0","1","2","3","4","roof"],Qe={roof:null,4:{x:31,y:124},3:{x:29,y:129},2:{x:29,y:137},1:{x:17,y:143},0:{x:28,y:150},ext:null},Ze={roof:null,4:[[15,122],[21,122],[32,122],[18,124],[29,123],[30,123],[29,124],[30,124],[29,125],[30,125]],3:[[16,129],[17,129],[15,131],[16,131],[17,131],[18,131],[15,132],[16,132],[17,132],[18,132],[20,129],[20,130],[20,131],[28,130],[29,130],[30,130],[28,131],[29,131],[30,131],[28,132],[29,132],[30,132]],2:[[15,136],[16,136],[17,136],[18,136],[19,136],[20,136],[15,137],[16,137],[17,137],[18,137],[19,137],[20,137],[31,137]],1:[[16,144],[17,144],[16,145],[17,145],[19,144],[20,144],[19,145],[20,144],[19,145],[20,145],[27,144],[28,144],[27,145],[30,144],[31,144],[30,145],[31,145],[16,143],[16,146],[17,146],[20,146],[28,143],[28,146],[30,143],[30,146],[31,146]],0:[[16,150],[18,152],[19,152],[21,150],[26,150],[26,151],[27,151],[28,151],[29,151],[30,151],[31,151],[31,150],[32,150]],ext:null};function m(e,t){const o=[],[n,r]=e,[s,i]=t;for(let a=r;a<=i;a++)for(let l=n;l<=s;l++)o.push([l,a]);return o}async function T(e){return new Promise(t=>setTimeout(t,e))}function po(e){return typeof e!="string"?!1:e.startsWith("http")}const ge="The door is locked. You are not qualified to enter here.";let z,q,K,x;async function go(){console.log("initRootURL",x),await WA.onInit().then(()=>{console.log("onInit",x);const e=WA.room.mapURL;console.log("mapUrl",e),x=e.substring(0,e.lastIndexOf("/")),console.log("root",x)})}async function Se(e){console.log("openDialogueBox"),z=await WA.ui.website.open({url:x+`/dialogue-box/index.html?id=${e}`,visible:!0,allowApi:!0,allowPolicy:"",position:{vertical:"bottom",horizontal:"middle"},size:{height:"120px",width:"650px"},margin:{bottom:"70px"}})}function Ee(){z==null||z.close()}async function et(e){const t=po(e)?e:`${x}/content/${e}`;K=await WA.nav.openCoWebSite(t)}function yo(){K==null||K.close()}function tt(e){if(console.log("Display banner of checkpoint",e),e==="-1"){WA.ui.banner.openBanner({id:"onboarding-banner",text:"CONGRATULATIONS! YOU HAVE SUCCESSFULLY FINISHED THE ONBOARDING AND COMPLETED ALL CHECKPOINTS!",bgColor:"#3402F0",textColor:"#FFFFFF",closable:!1,timeToClose:12e4});return}const t=U.find(o=>o.id===e);t&&WA.ui.banner.openBanner({id:"onboarding-banner",text:`${t.title}: ${t.description}`,bgColor:"#3402F0",textColor:"#FFFFFF",closable:!1,timeToClose:12e4})}function ye(e){WA.ui.banner.openBanner({id:"onboarding-banner",text:e,bgColor:"#FD4D26",textColor:"#FFFFFF",closable:!0,timeToClose:3e3})}function he(){WA.ui.banner.closeBanner()}function ho(){console.log("displayChecklistButton",x),WA.ui.actionBar.addButton({id:"checklist-btn",type:"action",imageSrc:`${x}/checklist-icon.svg`,toolTip:"Onboarding Checklist",callback:()=>{WA.ui.modal.openModal({title:"Plan",src:`${x}/checklist/index.html`,allowApi:!0,allow:"microphone; camera",position:"center"},()=>WA.ui.modal.closeModal())}})}async function mo(){q=await WA.ui.website.open({url:`${x}/helicopter.gif`,visible:!0,allowApi:!1,allowPolicy:"",position:{vertical:"middle",horizontal:"middle"},size:{height:"500px",width:"500px"}})}function bo(){q==null||q.close()}function Ao(e){e.type==="NPC"?wo(e):e.type==="content"?vo(e):e.type==="direction"?Co(e):console.error("Invalid area type while placing tile")}function wo(e){if(console.log(`Placing checkpoint ${e.id} (NPC tile)`),e.npcName&&e.npcSprite){const t=e.npcName.toLowerCase();WA.room.setTiles([{x:e.coordinates.x,y:e.coordinates.y,tile:`npc-${t}-${e.npcSprite}`,layer:Q(e.id)?"tour/content":"furniture/furniture3"}])}}function vo(e){console.log(`Placing checkpoint ${e.id} (content tile)`),WA.room.setTiles([{x:e.coordinates.x,y:e.coordinates.y,tile:"content",layer:Q(e.id)?"tour/content":"furniture/furniture1"}]),de(e.id)&&WA.room.setTiles([{x:e.coordinates.x,y:e.coordinates.y,tile:"smartphone",layer:"furniture/furniture2"}])}function Wo(e){WA.room.setTiles([{x:e.coordinates.x,y:e.coordinates.y,tile:null,layer:Q(e.id)?"tour/content":"furniture/furniture3"}])}function To(e){WA.room.setTiles([{x:e.coordinates.x,y:e.coordinates.y,tile:null,layer:Q(e.id)?"tour/content":"furniture/furniture1"}]),de(e.id)&&(WA.room.area.delete(e.id),WA.room.setTiles([{x:e.coordinates.x,y:e.coordinates.y,tile:null,layer:"furniture/furniture2"}]))}function Co(e){console.log(`Placing checkpoint ${e.id} (direction tile)`),WA.room.setTiles([{x:e.coordinates.x,y:e.coordinates.y,tile:"direction",layer:"furniture/furniture1"}])}function ot(e){WA.room.setTiles([{x:e.coordinates.x,y:e.coordinates.y,tile:null,layer:"furniture/furniture1"}])}function xo(e,t){ko(e,t),So(e,t)}function ko(e,t){WA.room.setTiles([{x:e,y:t,tile:"npc-jonas-tp",layer:"furniture/furniture3"}]),setTimeout(()=>{WA.room.setTiles([{x:e,y:t,tile:null,layer:"furniture/furniture3"}])},1e3)}function So(e,t){const s=[{dx:-1,dy:-1,id:1},{dx:0,dy:-1,id:2},{dx:1,dy:-1,id:3},{dx:-1,dy:0,id:4},{dx:0,dy:0,id:5},{dx:1,dy:0,id:6},{dx:-1,dy:1,id:7},{dx:0,dy:1,id:8},{dx:1,dy:1,id:9}],i=s.map(({dx:a,dy:l,id:c})=>({x:e+a,y:t+l,tile:`teleport-${c}`,layer:"above/above1"}));WA.room.setTiles(i),setTimeout(()=>{const a=s.map(({dx:l,dy:c})=>({x:e+l,y:t+c,tile:null,layer:"above/above1"}));WA.room.setTiles(a)},1800)}function Eo(e){let t=[];const o=Qe[e];o!==null&&(console.log("place content tile on coordinates",o),t.push({x:o.x,y:o.y,tile:`hide-checkpoint-floor-${e}`,layer:"above/above2"}));const n=Ze[e];n!==null&&(console.log("remove collision tiles on coordinates",n),n.forEach(([r,s])=>{t.push({x:r,y:s,tile:null,layer:"collisions"})})),WA.room.setTiles(t)}function Po(e){let t=[];const o=Qe[e];o!==null&&(console.log("remove content tile on coordinates",o),t.push({x:o.x,y:o.y,tile:null,layer:"above/above2"}));const n=Ze[e];n!==null&&(console.log("add collision tiles on coordinates",n),n.forEach(([r,s])=>{t.push({x:r,y:s,tile:"collision",layer:"collisions"})})),WA.room.setTiles(t)}let ne=!1;async function Bo(e,t){console.log("World script started successfully"),!He(t)&&!e.some(o=>X.includes(o))&&console.log("Player can't access this room yet."),Lo(),Do("cave")}function Lo(){for(let e=0;e<$.length-1;e++){const t=$[e],o=$[e+1];Pe(t,o)}for(let e=$.length-1;e>0;e--){const t=$[e],o=$[e-1];Pe(t,o)}}function Pe(e,t){WA.room.area.onEnter(`${e}-${t}`).subscribe(()=>{WA.nav.goToRoom(`#from-${e}-${t}`),WA.room.hideLayer(`tour/${e}`),Eo(e),WA.room.showLayer(`tour/${t}`),Po(t)})}function Do(e){WA.room.area.onEnter(`${e}Door`).subscribe(()=>{ne===!0?(ne=!1,WA.room.hideLayer(`roofs/${e}1`),WA.room.hideLayer(`roofs/${e}2`)):(ne=!0,WA.room.showLayer(`roofs/${e}1`),WA.room.showLayer(`roofs/${e}2`))})}async function No(){console.log("disablePlayerControls"),WA.controls.disablePlayerControls(),await T(100),console.log("camera.set"),WA.camera.set(39*32,13*32,1e3,1e3,!0,!0),await T(100),console.log("displayHelicopterGIF"),await mo(),await T(100),console.log("player.teleport"),WA.player.teleport(50*32,180*32),await T(100),console.log("removeAirportHelicopter"),$o(),await T(100),console.log("moveCameraToRooftop"),Ro(32*32,118*32,2e4),await T(2e4),console.log("LANDED"),console.log("placeRooftopHelicopter"),Mo(),await T(100),console.log("removeHelicopterGIF"),bo(),await T(100),console.log("player.teleport"),WA.player.teleport(27*32,116*32),await T(100),console.log("restorePlayerControls"),WA.controls.restorePlayerControls(),await T(100),WA.camera.followPlayer(!0)}function $o(){const e=m([34,10],[40,14]),t=e.map(([n,r])=>({x:n,y:r,tile:null,layer:"furniture/furniture1"})),o=e.map(([n,r])=>({x:n,y:r,tile:null,layer:"above/above1"}));WA.room.setTiles([...t,...o])}function Mo(){console.log("placeRooftopHelicopter()");const t=m([26,114],[32,118]).map(([o,n],r)=>({x:o,y:n,tile:`helicopter-landed-${r+1}`,layer:"above/above1"}));WA.room.setTiles(t)}function Ro(e,t,o){console.log("moveCameraToRooftop()"),window.parent.postMessage({type:"cameraSet",data:{x:e,y:t,width:1e3,height:1e3,lock:!0,smooth:!0,duration:o}},"*")}function Fo(){return WA.state.map}let Be=!1;function nt(e){let t=[];const o=pe(),n=Fo();console.log("Processing areas..."),U.forEach(r=>{if(rt(r,o)){const s=e.includes(r.id);t.push({id:r.id,title:r.title,done:s}),Vo(r,n)&&Go(r,e,o)&&jo(r,e)&&Z(r)}}),fe(t),tt(Ue(t))}function Io(e){const t=pe();console.log("Processing areas after on boarding..."),console.log("checkpointIdsAfterOnboarding",me),me.forEach(o=>{const n=U.find(r=>r.id===o);n&&rt(n,t)&&(Je(e,o)||Z(n))})}function Oo(e){console.log(`Placing checkpoint ${e.id} (area)`);const t=32,o=128,n=e.coordinates.x*t,r=e.coordinates.y*t,s=n-(o-t)/2,i=r-(o-t)/2;WA.room.area.create({name:e.id,x:s,y:i,width:o,height:o}),WA.room.area.onEnter(e.id).subscribe(()=>{console.log("Entered checkpoint area",e.id),e.type==="NPC"&&e.message?Se(e.id):e.type==="content"&&e.url?et(e.url):e.type==="direction"&&e.message&&Se(e.id)}),WA.room.area.onLeave(e.id).subscribe(()=>{console.log("Leaved checkpoint area",e.id),e.type==="NPC"?Ee():e.type==="content"?(yo(),To(e),ae(e.id)):e.type==="direction"&&(e.message?Ee():(WA.room.area.delete(e.id),ot(e),ae(e.id)))})}function Vo(e,t){const o=e.id;return t!==e.map?(console.log(`Ignoring checkpoint ${o} (not the right map)`),!1):!0}function rt(e,t){const o=e.id,n=e.tags;return console.log("*********",e.title),console.log("playerTags",t),console.log("checkpointTags",n),console.log("playerTags.some(tag => checkpointTags.includes(tag)",t.some(r=>n==null?void 0:n.includes(r))),n&&!t.some(r=>n.includes(r))?(console.log(`Ignoring checkpoint ${o} (not the right tags)`),!1):!0}function Go(e,t,o){const n=e.id;return de(n)&&(!Kt(t)||_e(t))?(console.log(`Ignoring checkpoint ${n} (milestone Jonas phone)`),!1):qt(n)&&!zt(t)&&!o.includes("guest")?(console.log(`Ignoring checkpoint ${n} (milestone meet Jonas)`),!1):fo(n)&&!Xe(t)&&!o.includes("guest")?(console.log(`Ignoring checkpoint ${n} (milestone onboarding)`),!1):!0}function jo(e,t){const o=e.id;if(t.includes(e.id)){if(e.type==="NPC"&&e.npcName==="Jonas")return console.log(`Ignoring checkpoint ${o} (already met this Jonas)`),!1;if(e.type==="direction")return console.log(`Ignoring checkpoint ${o} (already passed this direction)`),!1}else if(e.type==="NPC"&&e.npcName==="Jonas"){if(Be)return console.log(`Ignoring checkpoint ${o} (next Jonas is already placed)`),!1;Be=!0}return!0}function Le(e,t,o){e==="town"?Uo(t,o):e==="world"&&qo(t,o)}let g={hr:{access:!0,blockingTiles:[[80,74],[83,74]]},arcade:{access:!1,blockingTiles:[[16,116],[19,116]]},stadium:{access:!1,blockingTiles:[[18,77],[20,77]]},wikitek:{access:!1,blockingTiles:[[77,110],[82,110]]},streaming:{access:!1,blockingTiles:[[69,40],[72,40]]},cave:{access:!1,blockingTiles:[[49,11],[50,11]]},backstage:{access:!1,blockingTiles:[[29,49],[30,51]]},service:{access:!1,blockingTiles:[[10,39],[12,41]]}},E={alt:{access:!1,leftWall:[[41,4],[41,5]],rightWall:[[44,4],[44,5]],pillar:[[42,5],[43,6]]},fr:{access:!1,leftWall:[[45,2],[45,3]],rightWall:[[48,2],[48,3]],pillar:[[46,3],[47,4]]},ext:{access:!1,leftWall:[[50,2],[50,3]],rightWall:[[53,2],[53,3]],pillar:[[51,3],[52,4]]},pt:{access:!1,leftWall:[[54,4],[54,5]],rightWall:[[57,4],[57,5]],pillar:[[55,5],[56,6]]}},N={hrMeetingDoor1:{access:!1,tilesNamePattern:"hr-meeting-door",tilesCoordinates:[[71,62],[72,63]]},hrMeetingDoor2:{access:!1,tilesNamePattern:"hr-meeting-door",tilesCoordinates:[[76,62],[77,63]]},hrMeetingDoor3:{access:!1,tilesNamePattern:"hr-meeting-door",tilesCoordinates:[[88,62],[89,63]]},hrMeetingDoor4:{access:!1,tilesNamePattern:"hr-meeting-door",tilesCoordinates:[[93,62],[94,63]]}};function Uo(e,t){if(e.includes("guest"))Object.keys(g).forEach(o=>{g[o].access=o==="hr"||o==="arcade"});else if(e.some(o=>ct.includes(o))){const o=Xe(t);g.stadium.access=!0,g.cave.access=!0,g.hr.access=!0,g.service.access=co(t),g.arcade.access=o,g.streaming.access=o,g.wikitek.access=o,g.backstage.access=o,He(t)&&(E.alt.access=e.includes("alt"),E.fr.access=e.includes("fr"),E.ext.access=e.includes("ext"),E.pt.access=e.includes("pt")),e.some(n=>X.includes(n))&&(console.log("Open all town doors"),Object.keys(g).forEach(n=>{g[n].access=!0}),E.fr.access=!0)}for(const o in g)Jo(o);for(const o in N)Ho(o,e);Yo(),console.log("townBuildings",g),console.log("townCaveProfileDoors",E),console.log("hrMeetingDoors",N)}function Jo(e){let t=!0;g[e].access?e==="service"?WA.room.area.onEnter(`${e}Door`).subscribe(()=>{console.log("listenTownDoor() onEnter"),se(e),t===!0?(t=!1,WA.room.hideLayer("roofs/backstage1"),WA.room.hideLayer("roofs/stadium1")):(t=!0,WA.room.showLayer("roofs/backstage1"),WA.room.showLayer("roofs/stadium1"))}):WA.room.area.onEnter(`${e}Door`).subscribe(()=>{console.log("listenTownDoor() onEnter"),se(e),t===!0?(t=!1,WA.room.hideLayer(`roofs/${e}1`),WA.room.hideLayer(`roofs/${e}2`)):(t=!0,WA.room.showLayer(`roofs/${e}1`),WA.room.showLayer(`roofs/${e}2`))}):(_o(e),WA.room.area.onEnter(`${e}Door`).subscribe(()=>{ye(ge)}),WA.room.area.onLeave(`${e}Door`).subscribe(()=>{he()}))}function Ho(e,t){let o;De(e),t.some(n=>["admin","hr"].includes(n))&&(WA.room.area.onEnter(e).subscribe(()=>{o=WA.ui.displayActionMessage({message:`Press SPACE to ${N[e].access?"close":"open"} the door`,callback:()=>{WA.event.broadcast(e,!N[e].access)}})}),WA.room.area.onLeave(e).subscribe(()=>{o==null||o.remove(),o=null})),WA.event.on(e).subscribe(n=>{N[e].access=n.data,De(e)})}function De(e){const t=N[e],o=m(t.tilesCoordinates[0],t.tilesCoordinates[1]),n=`${t.tilesNamePattern}-${N[e].access?"open":"closed"}`,r=o.map(([s,i],a)=>({x:s,y:i,tile:`${n}-${a+1}`,layer:"furniture/furniture2"}));WA.room.setTiles(r)}function _o(e){const t=g[e],n=m(t.blockingTiles[0],t.blockingTiles[1]).map(([r,s])=>({x:r,y:s,tile:"collision",layer:"collisions"}));WA.room.setTiles(n)}function se(e){const t=g[e],n=m(t.blockingTiles[0],t.blockingTiles[1]).map(([r,s])=>({x:r,y:s,tile:null,layer:"collisions"}));WA.room.setTiles(n)}function Yo(){Object.keys(E).forEach(e=>{E[e].access===!0&&st(e)})}function st(e){const t=E[e],o=m(t.pillar[0],t.pillar[1]),n=m(t.leftWall[0],t.leftWall[1]),r=m(t.rightWall[0],t.rightWall[1]),s=o.map(([c,f],p)=>({x:c,y:f,tile:`no-pillar-${p+1}`,layer:"walls/walls1"})),i=n.map(([c,f],p)=>({x:c,y:f,tile:`cave-door-wall-open-${p+1}`,layer:"walls/walls1"})),a=r.map(([c,f],p)=>({x:c,y:f,tile:`cave-door-wall-open-${p+1}`,layer:"walls/walls1"})),l=[...s,...i,...a];WA.room.setTiles(l)}function zo(e){let t=null;return e.includes("fr")?t="fr":e.includes("alt")?t="alt":e.includes("ext")?t="ext":e.includes("pt")&&(t="pt"),t}let B={cave:{access:!1,blockingTiles:[[29,181],[29,182]]},airport:{access:!1,blockingTiles:[[51,22],[53,22]]}},b={achievements:{access:!0,blockingTiles:[[84,168],[87,168]]},values:{access:!0,blockingTiles:[[61,159],[61,163]]},legal:{access:!0,blockingTiles:[[37,107],[37,111]]},bridge:{access:!0,blockingTiles:[[18,83],[22,83]]},france:{access:!0,blockingTiles:[[19,67],[21,67]]},hungary:{access:!0,blockingTiles:[[72,48],[72,52]]},belgium:{access:!0,blockingTiles:[[102,23],[106,23]]},netherlands:{access:!0,blockingTiles:[[70,30],[70,34]]}},M={access:!1,turnstile:[[52,11],[52,12]],lightsY:[[52,6],[52,10]],lightsX:[[48,5],[52,5]]},w={floor4:{access:!1,tilesNamePattern:"rooftop-to-floor4",tilesCoordinates:[[23,117],[23,117]]},floor3:{access:!1,tilesNamePattern:"floor4-to-floor3",tilesCoordinates:[[22,126],[25,126]]},floor2:{access:!1,tilesNamePattern:"floor3-to-floor2",tilesCoordinates:[[22,133],[25,133]]},floor1:{access:!1,tilesNamePattern:"floor2-to-floor1",tilesCoordinates:[[22,140],[25,140]]},floor0:{access:!1,tilesNamePattern:"floor1-to-floor0",tilesCoordinates:[[22,147],[25,147]]},exit:{access:!1,tilesNamePattern:"floor0-to-exit",tilesCoordinates:[[22,154],[25,154]]}};function qo(e,t){B.cave.access=_e(t),B.airport.access=Ke(t),b.achievements.access=Xt(t),b.values.access=Qt(t),b.legal.access=Zt(t),b.bridge.access=eo(t),b.france.access=to(t),b.hungary.access=Ye(t),b.belgium.access=ze(t),b.netherlands.access=qe(t),M.access=oo(t),w.floor4.access=no(t),w.floor3.access=ro(t),w.floor2.access=so(t),w.floor1.access=io(t),w.floor0.access=ao(t),w.exit.access=lo(t),e.some(o=>X.includes(o))&&(console.log("Open all world doors"),Object.keys(B).forEach(o=>{B[o].access=!0}),Object.keys(b).forEach(o=>{b[o].access=!0}),M.access=!0,Object.keys(w).forEach(o=>{w[o].access=!0})),Ne("cave"),Ne("airport"),Xo(),M.access&&it(),Qo(),console.log("worldBuildings",B),console.log("worldBarriers",b),console.log("airportGate",M),console.log("brTourFloors",w)}function Ne(e){let t=e!=="cave";B[e].access?WA.room.area.onEnter(`${e}Door`).subscribe(()=>{console.log("listenWorldDoor() onEnter"),ie(e),t===!0?(t=!1,WA.room.hideLayer(`roofs/${e}1`)):(t=!0,WA.room.showLayer(`roofs/${e}1`))}):(Ko(e),WA.room.area.onEnter(`${e}Door`).subscribe(()=>{ye(ge)}),WA.room.area.onLeave(`${e}Door`).subscribe(()=>{he()}))}function Ko(e){const t=B[e],n=m(t.blockingTiles[0],t.blockingTiles[1]).map(([r,s])=>({x:r,y:s,tile:"collision",layer:"collisions"}));WA.room.setTiles(n)}function ie(e){const t=B[e],n=m(t.blockingTiles[0],t.blockingTiles[1]).map(([r,s])=>({x:r,y:s,tile:null,layer:"collisions"}));WA.room.setTiles(n)}function Xo(){console.log("unlockWorldBarriers()");let e=[];Object.entries(b).forEach(([t,o])=>{console.log("barrierName",t),o.access&&(console.log("has access"),m(o.blockingTiles[0],o.blockingTiles[1]).forEach(([r,s])=>{e.push({x:r,y:s,tile:null,layer:"walls/walls1"})}))}),WA.room.setTiles(e)}function P(e){const t=b[e];console.log("barrierData",t);const o=m(t.blockingTiles[0],t.blockingTiles[1]);console.log("tilesCoordinates",o);const n=o.map(([r,s])=>({x:r,y:s,tile:null,layer:"walls/walls1"}));WA.room.setTiles(n)}function it(){console.log("unlockAirportGate()");const o=m(M.turnstile[0],M.turnstile[1]).map(([n,r],s)=>({x:n,y:r,tile:`airport-turnstile-open-${s+1}`,layer:"furniture/furniture3"}));WA.room.setTiles(o)}function D(e){console.log("unlockBrTourFloorAccess()");let t=[];const o=w[e],n={floor4:"walls/walls2",floor3:"tour/4",floor2:"tour/3",floor1:"tour/2",floor0:"tour/1",exit:"tour/0"},r=m(o.tilesCoordinates[0],o.tilesCoordinates[1]);r.forEach(([s,i])=>{t.push({x:s,y:i,tile:null,layer:n[e]})}),r.forEach(([s,i],a)=>{t.push({x:s,y:i,tile:`${o.tilesNamePattern}-open-${a+1}`,layer:n[e]})}),WA.room.setTiles(t)}function Qo(){Object.keys(w).forEach(e=>{w[e].access===!0&&D(e)})}async function Zo(e){if(e.length>1)console.log("Existing player. Checkpoint IDs: ",e);else return console.log("New player."),C(["0"]),["0"];return e}function Z(e){Oo(e),Ao(e)}async function G(){const e=await S(),t=U.find(o=>o.id===Yt(e));t&&Z(t)}async function ae(e){he();const t=await S(),o=await je();Je(t,e)?console.log("(State: unchanged) Old checkpoint passed",e):(console.log("(State: update) New checkpoint passed",e),t.push(e),C(t),await en(e),await on(e),tt(Ue(o)))}async function en(e){let t=await je();const o=t.findIndex(n=>n.id===e);t[o].done=o!==-1,fe(t)}function tn(){WA.player.state.onVariableChange("closeDialogueBoxEvent").subscribe(async e=>{const t=e;t&&(console.log('Variable "closeDialogueBoxEvent" changed. New value: ',t),t.url&&(console.log("Open URL",t.url),et(t.url)),t.npcName==="Jonas"?(WA.room.area.delete(t.id),t.id==="32"||t.id==="36"?console.log("Don't move Jonas"):t.id==="23"?(console.log("Remove Jonas"),Wo(t)):(console.log("Teleport Jonas"),xo(t.coordinates.x,t.coordinates.y))):t.type==="direction"&&(console.log("Remove direction area and tile"),WA.room.area.delete(t.id),ot(t)),console.log("checkpoint.id",t.id),await ae(t.id))})}async function on(e){switch(e){case"2":const t=await S();nt(t);break;case"4":const o=pe(),n=zo(o);n?st(n):ye(ge);break;case"6":const r=U.find(f=>f.id==="7");r&&Z(r);break;case"7":ie("cave"),G();break;case"9":P("achievements");break;case"10":P("values");break;case"11":P("legal");break;case"12":P("bridge");break;case"13":P("france"),G();break;case"14":case"15":const s=await S();Ye(s)&&P("hungary");break;case"16":case"17":const i=await S();ze(i)&&P("belgium");break;case"18":case"19":const a=await S();qe(a)&&P("netherlands");break;case"20":case"21":const l=await S();Ke(l)&&ie("airport");break;case"22":it();break;case"23":await No(),console.log("TRAVEL FINISHED"),G();break;case"24":D("floor4"),G();break;case"25":D("floor3");break;case"26":D("floor2");break;case"27":D("floor1");break;case"28":D("floor0");break;case"29":D("exit");break;case"31":await T(1e3),G();break;case"32":WA.nav.goToRoom("/@/bedrock-1710774685/onboardingbr/town#from-tour");break;case"33":case"34":const c=await S();uo(c)&&(se("backstage"),Io(c));break}}function nn(){console.log("Town script started successfully")}console.log("Main script started successfully");WA.onInit().then(async()=>{console.log("Scripting API ready");const e=WA.player.tags;console.log("Player tags: ",e);const t=e.some(o=>ut.includes(o));_t().then(async()=>{console.log("Scripting API Extra ready");const o=WA.state.map,n=await S();if(await go(),tn(),t){if(Le(o,e,n),!e.some(r=>X.includes(r))){ho();const r=await Zo(n);nt(r)}o==="town"?nn():o==="world"&&Bo(e,n)}else console.log("No player tag recognized."),o==="world"&&(console.log("Player can't access this room."),WA.nav.goToRoom("/@/bedrock-1710774685/onboardingbr/town")),Le(o,e,n);WA.player.name==="Valdo"&&(WA.ui.actionBar.addButton({id:"start",label:"Start",callback:()=>{C([])}}),WA.ui.actionBar.addButton({id:"world",label:"World",callback:()=>{C(Array.from({length:4},(r,s)=>(s+1).toString()))}}),WA.ui.actionBar.addButton({id:"bridge",label:"Bridge",callback:()=>{C(Array.from({length:13},(r,s)=>(s+1).toString()))}}),WA.ui.actionBar.addButton({id:"airport",label:"Airport",callback:()=>{C(Array.from({length:22},(r,s)=>(s+1).toString()))}}),WA.ui.actionBar.addButton({id:"town",label:"Town",callback:()=>{C(Array.from({length:32},(r,s)=>(s+1).toString()))}}),WA.ui.actionBar.addButton({id:"onboarding",label:"Onboarding",callback:()=>{C(Array.from({length:34},(r,s)=>(s+1).toString()))}}),WA.ui.actionBar.addButton({id:"finish",label:"Finish",callback:()=>{C(Array.from({length:45},(r,s)=>(s+1).toString()))}}))}).catch(o=>console.error(o))}).catch(e=>console.error(e));
