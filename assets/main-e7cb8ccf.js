import{i as fe}from"./world-8fbf6ed0.js";import{c as pe,a as ge,s as de,b as N,o as he,r as ye,p as U,d as me,e as _,f as ve,i as be,g as we,h as Ae,j as We,k as Se,l as Ce}from"./tiles-da920fb8.js";class S{constructor(t){this.properties=t??[]}get(t){const n=this.properties.filter(r=>r.name===t).map(r=>r.value);if(n.length>1)throw new Error('Expected only one property to be named "'+t+'"');if(n.length!==0)return n[0]}getString(t){return this.getByType(t,"string")}getNumber(t){return this.getByType(t,"number")}getBoolean(t){return this.getByType(t,"boolean")}getByType(t,n){const r=this.get(t);if(r!==void 0){if(n!=="json"&&typeof r!==n)throw new Error('Expected property "'+t+'" to have type "'+n+'"');return r}}mustGetString(t){return this.mustGetByType(t,"string")}mustGetNumber(t){return this.mustGetByType(t,"number")}mustGetBoolean(t){return this.mustGetByType(t,"boolean")}mustGetByType(t,n){const r=this.get(t);if(r===void 0)throw new Error('Property "'+t+'" is missing');if(n!=="json"&&typeof r!==n)throw new Error('Expected property "'+t+'" to have type "'+n+'"');return r}getType(t){const n=this.properties.filter(r=>r.name===t).map(r=>r.type);if(n.length>1)throw new Error('Expected only one property to be named "'+t+'"');if(n.length!==0)return n[0]}}const ee="https://unpkg.com/@workadventure/scripting-api-extra@1.7.4/dist";class Te{constructor(t){this.name=t.name,this.x=t.x,this.y=t.y,this.properties=new S(t.properties)}get isReadable(){const t=this.properties.getString("readableBy");return t?WA.player.tags.includes(t):!0}get isWritable(){const t=this.properties.getString("writableBy");return t?WA.player.tags.includes(t):!0}}function q(e){const t=e?"#"+e.join():"";WA.nav.openCoWebSite(ee+"/configuration.html"+t,!0)}async function Ee(e,t){const n=await WA.room.getTiledMap(),r=new Map;return te(n.layers,r,e,t),r}function te(e,t,n,r){for(const s of e)if(s.type==="objectgroup"){for(const o of s.objects)if(o.type==="variable"||o.class==="variable"){if(n&&s.name!==n||r&&!r.includes(o.name))continue;t.set(o.name,new Te(o))}}else s.type==="group"&&te(s.layers,t,n,r)}let D;async function M(){return D===void 0&&(D=Le()),D}async function Le(){return Pe(await WA.room.getTiledMap())}function Pe(e){const t=new Map;return ne(e.layers,"",t),t}function ne(e,t,n){for(const r of e)r.type==="group"?ne(r.layers,t+r.name+"/",n):(r.name=t+r.name,n.set(r.name,r))}async function re(){const e=await M(),t=[];for(const n of e.values())if(n.type==="objectgroup")for(const r of n.objects)(r.type==="area"||r.class==="area")&&t.push(r);return t}function Me(e){let t=1/0,n=1/0,r=0,s=0;const o=e.data;if(typeof o=="string")throw new Error("Unsupported tile layer data stored as string instead of CSV");for(let a=0;a<e.height;a++)for(let i=0;i<e.width;i++)o[i+a*e.width]!==0&&(t=Math.min(t,i),s=Math.max(s,i),n=Math.min(n,a),r=Math.max(r,a));return{top:n,left:t,right:s+1,bottom:r+1}}function se(e){let t=1/0,n=1/0,r=0,s=0;for(const o of e){const a=Me(o);a.left<t&&(t=a.left),a.top<n&&(n=a.top),a.right>s&&(s=a.right),a.bottom>r&&(r=a.bottom)}return{top:n,left:t,right:s,bottom:r}}/*!
 * mustache.js - Logic-less {{mustache}} templates with JavaScript
 * http://github.com/janl/mustache.js
 */var Be=Object.prototype.toString,T=Array.isArray||function(t){return Be.call(t)==="[object Array]"};function G(e){return typeof e=="function"}function xe(e){return T(e)?"array":typeof e}function j(e){return e.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}function J(e,t){return e!=null&&typeof e=="object"&&t in e}function ke(e,t){return e!=null&&typeof e!="object"&&e.hasOwnProperty&&e.hasOwnProperty(t)}var Re=RegExp.prototype.test;function De(e,t){return Re.call(e,t)}var je=/\S/;function Ie(e){return!De(je,e)}var Ve={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;","`":"&#x60;","=":"&#x3D;"};function Ge(e){return String(e).replace(/[&<>"'`=\/]/g,function(n){return Ve[n]})}var Oe=/\s*/,$e=/\s+/,K=/\s*=/,Ne=/\s*\}/,Ue=/#|\^|\/|>|\{|&|=|!/;function _e(e,t){if(!e)return[];var n=!1,r=[],s=[],o=[],a=!1,i=!1,l="",u=0;function p(){if(a&&!i)for(;o.length;)delete s[o.pop()];else o=[];a=!1,i=!1}var y,v,x;function E(w){if(typeof w=="string"&&(w=w.split($e,2)),!T(w)||w.length!==2)throw new Error("Invalid tags: "+w);y=new RegExp(j(w[0])+"\\s*"),v=new RegExp("\\s*"+j(w[1])),x=new RegExp("\\s*"+j("}"+w[1]))}E(t||h.tags);for(var f=new B(e),b,c,m,L,k,W;!f.eos();){if(b=f.pos,m=f.scanUntil(y),m)for(var R=0,ue=m.length;R<ue;++R)L=m.charAt(R),Ie(L)?(o.push(s.length),l+=L):(i=!0,n=!0,l+=" "),s.push(["text",L,b,b+1]),b+=1,L===`
`&&(p(),l="",u=0,n=!1);if(!f.scan(y))break;if(a=!0,c=f.scan(Ue)||"name",f.scan(Oe),c==="="?(m=f.scanUntil(K),f.scan(K),f.scanUntil(v)):c==="{"?(m=f.scanUntil(x),f.scan(Ne),f.scanUntil(v),c="&"):m=f.scanUntil(v),!f.scan(v))throw new Error("Unclosed tag at "+f.pos);if(c==">"?k=[c,m,b,f.pos,l,u,n]:k=[c,m,b,f.pos],u++,s.push(k),c==="#"||c==="^")r.push(k);else if(c==="/"){if(W=r.pop(),!W)throw new Error('Unopened section "'+m+'" at '+b);if(W[1]!==m)throw new Error('Unclosed section "'+W[1]+'" at '+b)}else c==="name"||c==="{"||c==="&"?i=!0:c==="="&&E(m)}if(p(),W=r.pop(),W)throw new Error('Unclosed section "'+W[1]+'" at '+f.pos);return Je(qe(s))}function qe(e){for(var t=[],n,r,s=0,o=e.length;s<o;++s)n=e[s],n&&(n[0]==="text"&&r&&r[0]==="text"?(r[1]+=n[1],r[3]=n[3]):(t.push(n),r=n));return t}function Je(e){for(var t=[],n=t,r=[],s,o,a=0,i=e.length;a<i;++a)switch(s=e[a],s[0]){case"#":case"^":n.push(s),r.push(s),n=s[4]=[];break;case"/":o=r.pop(),o[5]=s[2],n=r.length>0?r[r.length-1][4]:t;break;default:n.push(s)}return t}function B(e){this.string=e,this.tail=e,this.pos=0}B.prototype.eos=function(){return this.tail===""};B.prototype.scan=function(t){var n=this.tail.match(t);if(!n||n.index!==0)return"";var r=n[0];return this.tail=this.tail.substring(r.length),this.pos+=r.length,r};B.prototype.scanUntil=function(t){var n=this.tail.search(t),r;switch(n){case-1:r=this.tail,this.tail="";break;case 0:r="";break;default:r=this.tail.substring(0,n),this.tail=this.tail.substring(n)}return this.pos+=r.length,r};function C(e,t){this.view=e,this.cache={".":this.view},this.parent=t}C.prototype.push=function(t){return new C(t,this)};C.prototype.lookup=function(t){var n=this.cache,r;if(n.hasOwnProperty(t))r=n[t];else{for(var s=this,o,a,i,l=!1;s;){if(t.indexOf(".")>0)for(o=s.view,a=t.split("."),i=0;o!=null&&i<a.length;)i===a.length-1&&(l=J(o,a[i])||ke(o,a[i])),o=o[a[i++]];else o=s.view[t],l=J(s.view,t);if(l){r=o;break}s=s.parent}n[t]=r}return G(r)&&(r=r.call(this.view)),r};function g(){this.templateCache={_cache:{},set:function(t,n){this._cache[t]=n},get:function(t){return this._cache[t]},clear:function(){this._cache={}}}}g.prototype.clearCache=function(){typeof this.templateCache<"u"&&this.templateCache.clear()};g.prototype.parse=function(t,n){var r=this.templateCache,s=t+":"+(n||h.tags).join(":"),o=typeof r<"u",a=o?r.get(s):void 0;return a==null&&(a=_e(t,n),o&&r.set(s,a)),a};g.prototype.render=function(t,n,r,s){var o=this.getConfigTags(s),a=this.parse(t,o),i=n instanceof C?n:new C(n,void 0);return this.renderTokens(a,i,r,t,s)};g.prototype.renderTokens=function(t,n,r,s,o){for(var a="",i,l,u,p=0,y=t.length;p<y;++p)u=void 0,i=t[p],l=i[0],l==="#"?u=this.renderSection(i,n,r,s,o):l==="^"?u=this.renderInverted(i,n,r,s,o):l===">"?u=this.renderPartial(i,n,r,o):l==="&"?u=this.unescapedValue(i,n):l==="name"?u=this.escapedValue(i,n,o):l==="text"&&(u=this.rawValue(i)),u!==void 0&&(a+=u);return a};g.prototype.renderSection=function(t,n,r,s,o){var a=this,i="",l=n.lookup(t[1]);function u(v){return a.render(v,n,r,o)}if(l){if(T(l))for(var p=0,y=l.length;p<y;++p)i+=this.renderTokens(t[4],n.push(l[p]),r,s,o);else if(typeof l=="object"||typeof l=="string"||typeof l=="number")i+=this.renderTokens(t[4],n.push(l),r,s,o);else if(G(l)){if(typeof s!="string")throw new Error("Cannot use higher-order sections without the original template");l=l.call(n.view,s.slice(t[3],t[5]),u),l!=null&&(i+=l)}else i+=this.renderTokens(t[4],n,r,s,o);return i}};g.prototype.renderInverted=function(t,n,r,s,o){var a=n.lookup(t[1]);if(!a||T(a)&&a.length===0)return this.renderTokens(t[4],n,r,s,o)};g.prototype.indentPartial=function(t,n,r){for(var s=n.replace(/[^ \t]/g,""),o=t.split(`
`),a=0;a<o.length;a++)o[a].length&&(a>0||!r)&&(o[a]=s+o[a]);return o.join(`
`)};g.prototype.renderPartial=function(t,n,r,s){if(r){var o=this.getConfigTags(s),a=G(r)?r(t[1]):r[t[1]];if(a!=null){var i=t[6],l=t[5],u=t[4],p=a;l==0&&u&&(p=this.indentPartial(a,u,i));var y=this.parse(p,o);return this.renderTokens(y,n,r,p,s)}}};g.prototype.unescapedValue=function(t,n){var r=n.lookup(t[1]);if(r!=null)return r};g.prototype.escapedValue=function(t,n,r){var s=this.getConfigEscape(r)||h.escape,o=n.lookup(t[1]);if(o!=null)return typeof o=="number"&&s===h.escape?String(o):s(o)};g.prototype.rawValue=function(t){return t[1]};g.prototype.getConfigTags=function(t){return T(t)?t:t&&typeof t=="object"?t.tags:void 0};g.prototype.getConfigEscape=function(t){if(t&&typeof t=="object"&&!T(t))return t.escape};var h={name:"mustache.js",version:"4.2.0",tags:["{{","}}"],clearCache:void 0,escape:void 0,parse:void 0,render:void 0,Scanner:void 0,Context:void 0,Writer:void 0,set templateCache(e){P.templateCache=e},get templateCache(){return P.templateCache}},P=new g;h.clearCache=function(){return P.clearCache()};h.parse=function(t,n){return P.parse(t,n)};h.render=function(t,n,r,s){if(typeof t!="string")throw new TypeError('Invalid template! Template should be a "string" but "'+xe(t)+'" was given as the first argument for mustache#render(template, view, partials)');return P.render(t,n,r,s)};h.escape=Ge;h.Scanner=B;h.Context=C;h.Writer=g;class oe{constructor(t,n){this.template=t,this.state=n,this.ast=h.parse(t)}getValue(){return this.value===void 0&&(this.value=h.render(this.template,this.state)),this.value}onChange(t){const n=[];for(const r of this.getUsedVariables().values())n.push(this.state.onVariableChange(r).subscribe(()=>{const s=h.render(this.template,this.state);s!==this.value&&(this.value=s,t(this.value))}));return{unsubscribe:()=>{for(const r of n)r.unsubscribe()}}}isPureString(){return this.ast.length===0||this.ast.length===1&&this.ast[0][0]==="text"}getUsedVariables(){const t=new Set;return this.recursiveGetUsedVariables(this.ast,t),t}recursiveGetUsedVariables(t,n){for(const r of t){const s=r[0],o=r[1],a=r[4];["name","&","#","^"].includes(s)&&n.add(o),a!==void 0&&typeof a!="string"&&this.recursiveGetUsedVariables(a,n)}}}async function Ke(){var e;const t=await re();for(const n of t){const r=(e=n.properties)!==null&&e!==void 0?e:[];for(const s of r){if(s.type==="int"||s.type==="bool"||s.type==="object"||typeof s.value!="string")continue;const o=new oe(s.value,WA.state);if(o.isPureString())continue;const a=o.getValue();await Y(n.name,s.name,a),o.onChange(async i=>{await Y(n.name,s.name,i)})}}}async function Ye(){var e;const t=await M();for(const[n,r]of t.entries())if(r.type!=="objectgroup"){const s=(e=r.properties)!==null&&e!==void 0?e:[];for(const o of s){if(o.type==="int"||o.type==="bool"||o.type==="object"||typeof o.value!="string")continue;const a=new oe(o.value,WA.state);if(a.isPureString())continue;const i=a.getValue();z(n,o.name,i),a.onChange(l=>{z(n,o.name,l)})}}}async function Y(e,t,n){console.log(e),(await WA.room.area.get(e)).setProperty(t,n)}function z(e,t,n){WA.room.setProperty(e,t,n),t==="visible"&&(n?WA.room.showLayer(e):WA.room.hideLayer(e))}const ze="https://admin.workadventu.re/html";let V,O=0,$=0;function X(e){if(WA.state[e.name]){let t=e.properties.mustGetString("openLayer");for(const n of t.split(`
`))WA.room.showLayer(n);t=e.properties.mustGetString("closeLayer");for(const n of t.split(`
`))WA.room.hideLayer(n)}else{let t=e.properties.mustGetString("openLayer");for(const n of t.split(`
`))WA.room.hideLayer(n);t=e.properties.mustGetString("closeLayer");for(const n of t.split(`
`))WA.room.showLayer(n)}}function Xe(e){const t=e.properties.getString("openSound"),n=e.properties.getNumber("soundRadius");let r=1;if(n){const s=ie(e.properties.mustGetString("openLayer").split(`
`));if(s>n)return;r=1-s/n}t&&WA.sound.loadSound(t).play({volume:r})}function He(e){const t=e.properties.getString("closeSound"),n=e.properties.getNumber("soundRadius");let r=1;if(n){const s=ie(e.properties.mustGetString("closeLayer").split(`
`));if(s>n)return;r=1-s/n}t&&WA.sound.loadSound(t).play({volume:r})}function ae(e){return e.map(t=>V.get(t)).filter(t=>(t==null?void 0:t.type)==="tilelayer")}function ie(e){const t=ae(e),n=se(t),r=((n.right-n.left)/2+n.left)*32,s=((n.bottom-n.top)/2+n.top)*32;return Math.sqrt(Math.pow(O-r,2)+Math.pow($-s,2))}function Qe(e){WA.state.onVariableChange(e.name).subscribe(()=>{WA.state[e.name]?Xe(e):He(e),X(e)}),X(e)}function H(e,t,n,r){const s=e.name;let o,a,i=!1;const l=n.getString("tag");let u=!0;l&&!WA.player.tags.includes(l)&&(u=!1);const p=!!l;function y(){var c;o&&o.remove(),o=WA.ui.displayActionMessage({message:(c=n.getString("closeTriggerMessage"))!==null&&c!==void 0?c:"Press SPACE to close the door",callback:()=>{WA.state[t.name]=!1,v()}})}function v(){var c;o&&o.remove(),o=WA.ui.displayActionMessage({message:(c=n.getString("openTriggerMessage"))!==null&&c!==void 0?c:"Press SPACE to open the door",callback:()=>{WA.state[t.name]=!0,y()}})}function x(){let c;if(e.type==="tilelayer")c=se(ae(t.properties.mustGetString("closeLayer").split(`
`)));else{if(e.x===void 0||e.y===void 0||e.width===void 0||e.height===void 0)throw new Error(`Doorstep zone "${e.name}" is missing x, y, width or height`);c={top:e.y,left:e.x,right:e.x+e.width,bottom:e.y+e.height}}a=WA.room.website.create({name:"doorKeypad"+s,url:r+"/keypad.html#"+encodeURIComponent(s),position:{x:c.right*32,y:c.top*32,width:32*3,height:32*4},allowApi:!0})}function E(){a&&(WA.room.website.delete(a.name),a=void 0)}function f(){if(i=!0,n.getBoolean("autoOpen")&&u){WA.state[t.name]=!0;return}if(!WA.state[t.name]&&(p&&!u||!p)&&(n.getString("code")||n.getString("codeVariable"))){x();return}u&&(WA.state[t.name]?y():v())}function b(){i=!1,n.getBoolean("autoClose")&&(WA.state[t.name]=!1),o&&o.remove(),E()}e.type==="tilelayer"?(WA.room.onEnterLayer(s).subscribe(f),WA.room.onLeaveLayer(s).subscribe(b)):(WA.room.area.onEnter(s).subscribe(f),WA.room.area.onLeave(s).subscribe(b)),WA.state.onVariableChange(t.name).subscribe(()=>{i&&(!n.getBoolean("autoClose")&&WA.state[t.name]===!0&&y(),a&&WA.state[t.name]===!0&&E(),!n.getBoolean("autoOpen")&&WA.state[t.name]===!1&&v())})}function Fe(e){const t=e.properties.mustGetString("bellSound"),n=e.properties.getNumber("soundRadius");let r=1;if(n){const s=Math.sqrt(Math.pow(e.x-O,2)+Math.pow(e.y-$,2));if(s>n)return;r=1-s/n}WA.sound.loadSound(t).play({volume:r})}function Ze(e){WA.state[e.name]===void 0&&(WA.state[e.name]=0),WA.state.onVariableChange(e.name).subscribe(()=>{WA.state[e.name]&&Fe(e)})}function Q(e,t,n){let r;const s=t.getString("bellPopup");if(n.type==="tilelayer"){const o=n.name;WA.room.onEnterLayer(o).subscribe(()=>{var a;s?r=WA.ui.openPopup(s,"",[{label:(a=t.getString("bellButtonText"))!==null&&a!==void 0?a:"Ring",callback:()=>{WA.state[e]=WA.state[e]+1}}]):WA.state[e]=WA.state[e]+1}),WA.room.onLeaveLayer(o).subscribe(()=>{r&&(r.close(),r=void 0)})}else{const o=n.name;WA.room.area.onEnter(o).subscribe(()=>{var a;s?r=WA.ui.openPopup(s,"",[{label:(a=t.getString("bellButtonText"))!==null&&a!==void 0?a:"Ring",callback:()=>{WA.state[e]=WA.state[e]+1}}]):WA.state[e]=WA.state[e]+1}),WA.room.area.onLeave(o).subscribe(()=>{r&&(r.close(),r=void 0)})}}async function et(e){e=e??ze;const t=await Ee();V=await M();for(const n of t.values())n.properties.get("door")&&Qe(n),n.properties.get("bell")&&Ze(n);for(const n of V.values()){const r=new S(n.properties),s=r.getString("doorVariable");if(s&&n.type==="tilelayer"){const a=t.get(s);if(a===void 0)throw new Error('Cannot find variable "'+s+'" referred in the "doorVariable" property of layer "'+n.name+'"');H(n,a,r,e)}const o=r.getString("bellVariable");o&&n.type==="tilelayer"&&Q(o,r,n)}for(const n of await re()){const r=new S(n.properties),s=r.getString("doorVariable");if(s){const a=t.get(s);if(a===void 0)throw new Error('Cannot find variable "'+s+'" referred in the "doorVariable" property of object "'+n.name+'"');H(n,a,r,e)}const o=r.getString("bellVariable");o&&Q(o,r,n)}WA.player.onPlayerMove(n=>{O=n.x,$=n.y})}function tt(e,t){const n=e.getString("bindVariable");if(n){const r=e.get("enterValue"),s=e.get("leaveValue"),o=e.getString("triggerMessage"),a=e.getString("tag");nt(n,t,r,s,o,a)}}function nt(e,t,n,r,s,o){o&&!WA.player.tags.includes(o)||(n!==void 0&&WA.room.onEnterLayer(t).subscribe(()=>{s||(WA.state[e]=n)}),r!==void 0&&WA.room.onLeaveLayer(t).subscribe(()=>{WA.state[e]=r}))}async function rt(){const e=await M();for(const t of e.values()){const n=new S(t.properties);tt(n,t.name)}}let F;async function st(e){const t=await WA.room.getTiledMap();e=e??ee,F=await M();const n=t.layers.find(r=>r.name==="configuration");if(n){const s=new S(n.properties).getString("tag");(!s||WA.player.tags.includes(s))&&WA.ui.registerMenuCommand("Configure the room",()=>{WA.nav.openCoWebSite(e+"/configuration.html",!0)});for(const o of F.values()){const a=new S(o.properties),i=a.getString("openConfig");i&&o.type==="tilelayer"&&ot(i.split(","),o.name,a)}}}function ot(e,t,n){let r;const s=n.getString("openConfigAdminTag");let o=!0;s&&!WA.player.tags.includes(s)&&(o=!1);function a(){var l;r&&r.remove(),r=WA.ui.displayActionMessage({message:(l=n.getString("openConfigTriggerMessage"))!==null&&l!==void 0?l:"Press SPACE or touch here to configure",callback:()=>q(e)})}function i(){WA.nav.closeCoWebSite()}WA.room.onEnterLayer(t).subscribe(()=>{const l=n.getString("openConfigTrigger");o&&(l&&l==="onaction"?a():q(e))}),WA.room.onLeaveLayer(t).subscribe(()=>{r&&r.remove(),i()})}function at(){return WA.onInit().then(()=>{et().catch(e=>console.error(e)),rt().catch(e=>console.error(e)),st().catch(e=>console.error(e)),Ye().catch(e=>console.error(e)),Ke().catch(e=>console.error(e))}).catch(e=>console.error(e))}function it(){console.log("Town script started successfully")}let Z=!1;function lt(e){let t=[];console.log("Processing areas..."),pe.forEach(n=>{if(ft(n)){const r=e.includes(n.id);t.push({id:n.id,title:n.title,done:r}),ut(n)&&pt(n,e)&&(ct(n),ge(n))}}),de(t)}function ct(e){console.log("placing area of checkpoint",e.id);const t=32,n=128,r=e.coordinates.x*t,s=e.coordinates.y*t,o=r-(n-t)/2,a=s-(n-t)/2;WA.room.area.create({name:e.id,x:o,y:a,width:n,height:n}),WA.room.area.onEnter(e.id).subscribe(()=>{console.log("onEnter checkpoint",e.id),e.type==="NPC"&&e.message?N(e.id):e.type==="content"&&e.url?he(e.url):e.type==="direction"&&e.message&&N(e.id)}),WA.room.area.onLeave(e.id).subscribe(()=>{console.log("onLeave checkpoint",e.id),e.type==="NPC"?_():e.type==="content"?(ve(),ye(e.coordinates.x,e.coordinates.y),U(e.id)):e.type==="direction"&&(WA.room.area.delete(e.id),me(e.coordinates.x,e.coordinates.y),U(e.id),e.message&&_())})}function ut(e){const t=e.id;return le!==e.map?(console.log(`Can't access checkpoint ${t} because it's not the right map`),!1):!0}function ft(e){const t=e.id;return e.tags&&e.tags.every(n=>!ce.includes(n))?(console.log(`Can't access checkpoint ${t} because player doesn't have the right tags`),!1):!0}function pt(e,t){const n=e.id;if(t.includes(e.id)){if(e.type==="NPC"&&e.npcName==="Jonas")return console.log(`Can't access checkpoint ${n} because player has already met this Jonas`),!1;if(e.type==="direction")return console.log(`Can't access checkpoint ${n} because player has already passed this direction`),!1}else if(e.type==="NPC"&&e.npcName==="Jonas"){if(Z)return console.log(`Can't access checkpoint ${n} because next Jonas is already placed`),!1;Z=!0}return!0}let le,ce;async function gt(e,t){le=e,ce=t;const n=await be();lt(n)}let I=!0,d={hr:{access:!0,blockingTiles:[[80,74],[81,74],[82,74],[83,74]]},arcade:{access:!1,blockingTiles:[[16,116],[17,116],[18,116],[19,116]]},stadium:{access:!1,blockingTiles:[[18,77],[19,77],[20,77]]},wikitek:{access:!1,blockingTiles:[[77,110],[78,110],[79,110],[80,110],[81,110],[82,110]]},streaming:{access:!1,blockingTiles:[[69,40],[70,40],[71,40],[72,40]]},cave:{access:!1,blockingTiles:[[49,11],[50,11]]},backstage:{access:!1,blockingTiles:[[29,49],[30,49],[29,51],[30,51]]}};function dt(e,t,n){if(t.includes("guest"))Object.keys(d).forEach(r=>{d[r].access=r==="hr"||r==="arcade"});else if(t.some(r=>["fr","pt","ext","alt"].includes(r))){const r=we(n);d.stadium.access=!0,d.cave.access=!0,d.hr.access=!0,d.arcade.access=r,d.streaming.access=r,d.wikitek.access=r,d.backstage.access=r}else t.some(r=>["admin","br","hr"].includes(r))&&Object.keys(d).forEach(r=>{d[r].access=!0});e==="town"?(A("hr"),A("arcade"),A("stadium"),A("wikitek"),A("streaming"),A("cave"),A("backstage")):e==="world"&&A("cave")}function A(e){d[e].access?WA.room.area.onEnter(`${e}Door`).subscribe(()=>{yt(e),I===!0?(I=!1,WA.room.hideLayer(`roofs/${e}1`),WA.room.hideLayer(`roofs/${e}2`)):(I=!0,WA.room.showLayer(`roofs/${e}1`),WA.room.showLayer(`roofs/${e}2`))}):(ht(e),WA.room.area.onEnter(`${e}Door`).subscribe(()=>{Ae("You are not qualified to enter here.")}),WA.room.area.onLeave(`${e}Door`).subscribe(()=>{We()}))}function ht(e){const n=d[e].blockingTiles.map(([r,s])=>({x:r,y:s,tile:"collision",layer:"collisions"}));WA.room.setTiles(n)}function yt(e){const n=d[e].blockingTiles.map(([r,s])=>({x:r,y:s,tile:null,layer:"collisions"}));WA.room.setTiles(n)}console.log("Main script started successfully");WA.onInit().then(()=>{console.log("Scripting API ready");const e=WA.player.tags;console.log("Player tags: ",e),e.includes("guest")||(WA.controls.disableInviteButton(),Se()),at().then(async()=>{console.log("Scripting API Extra ready");const t=await WA.state.map;t==="town"?it():t==="world"&&fe();const n=await Ce();dt(t,e,n),gt(t,e)}).catch(t=>console.error(t))}).catch(e=>console.error(e));
